![[1687516011811.png]]
对于S[i]，用单调栈找到第一个S[j]，使得S[j] < S[i]，即快乐子数组的范围为[i, j - 1]
其S[i, j - 1]所有子数组的和为：
$$W_{i+1}(j-(i+1))+W_{i+2} \cdot(j-(i+2))+\cdots+W_{j-1}(j-(j-1))$$
如何求出上式的和：
> 观察可得，上式是某一段乘上一个等差数列。

- 等价于预处理的等差数列加上某个前缀和的若干倍数
![[1687516977241.png]]