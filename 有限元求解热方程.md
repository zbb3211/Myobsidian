
周硕 2022Z8017782058    林凌  2022Z8017782029    周文康  2022Z8017782107

---
# 一、问题描述
热方程(Heat equation)描述了物体内部温度的演化过程，它可以用来模拟和预测热传导现象，如热传导在固体材料中的传播、液体中的对流换热等。通过求解热方程，我们可以获得物体在不同时间和空间点的温度分布，从而了解物体的热行为和热传导特性。

PETSc Example45 展示了如何使用 PETSC求解二维随时间变化的热传导方程，即下面的方程:
$$\frac{\partial u}{\partial t}=\alpha\left(\frac{\partial^{2} u}{\partial x^{2}}+\frac{\partial^{2} u}{\partial y^{2}}\right)+f(x, y, t)$$
在这个方程中，$u(x, y, t)$表示物体在位置$(x, y)$和时间$t$的温度，$\frac{\partial u}{\partial t}$表示温度随时间的变化率，$\frac{\partial^{2} u}{\partial x^{2}}$和$\frac{\partial^{2} u}{\partial y^{2}}$分别表示温度在$x$方向和$y$方向上的二阶空间导数。

$\alpha$是热扩散系数，它描述了物体传导热量的能力。$f(x, y, t)$表示外部的热源或热流密度，它可以是一个给定的函数，表示在空间和时间上变化的热源或热流。

该方程描述了二维平面上的温度场随时间的淡化，它告诉我们温度场在时间上如何变化，以及空间上如何扩故和受到热源和热汇的影响。PETSC Example45 使用了隐式时间离散化方法和有限元空间离散化方法来求解该方程。

# 二、离散化方法
## 1. 并行非结构化网格
![[Pasted image 20230618222020.png|300]]
非结构化网格是一种用于离散化物理域的网格表示方法，适用于描述具有复杂几何形状和不规则连接的问题。

而并行非结构化网格是一种在并行计算环境下使用的网格表示方法。并行非结构化网格由多个子网格组成，每个子网格由一个或多个计算节点处理。这些子网格可以是不规则的形状，具有不同的拓扑结构和尺寸。在并行计算中，这些子网格可以并行处理和更新，从而实现高效的计算和数据交换。
## 2. 并行非结构化网络实现离散化
我们在矩形域中求解热方程，使用并行非结构化网格 (DMPLEX) 对其进行离散化，将连续的热方程转化为离散的数值计算问题。。

在离散化热方程并使用并行非结构化网格进行数值求解时，我们采用了有限差分方法。这种方法基于以下原理：
- 空间离散化：将矩形域划分为离散的网格节点，并使用有限差分近似温度在空间上的变化。我们使用网格节点 $(i,j)$ 表示离散的空间位置，其中 $i$ 和 $j$ 分别表示在水平和垂直方向上的索引。
- 时间离散化：将时间连续性转化为离散的时间步长。我们使用 $n$ 表示离散的时间步数，$\Delta t$ 表示时间步长。

离散化过程如下：
1. 空间离散化：
    - 将矩形域划分为离散的网格节点，并使用网格节点 $(i, j)$ 表示离散的空间位置。
    - 使用网格步长 $\Delta x$ 和 $\Delta y$ 表示在水平和垂直方向上的空间离散化。
2. 时间离散化：
	- 将时间连续性转化为离散的时间步长 $\Delta t$。
3. 近似空间二阶导数的离散差分：对于每个时间步 $n+1$，对网格中的每个节点 $(i, j)$ 进行如下计算：
	- 对网格节点 $(i, j)$ 处的温度 $u$ 在水平和垂直方向上进行离散差分计算，得到 $\Delta_{x^2}u_{i, j}$ 和 $\Delta_{y^2}u_{i, j}$，分别表示二阶导数的离散差分近似。
4. 迭代计算：对于每个时间步 $n = 0, 1, 2, ..., M-1$，对网格中的每个节点 $(i, j)$ 进行如下计算：
	1. 计算空间二阶导数的离散差分：
$$\Delta_{x^2}u_{i, j} = \frac{u_{i+1, j}^n - 2u_{i, j}^n + u_{i-1, j}^n}{(\Delta x)^2}$$
	$$\Delta_{y^2}u_{i, j} = \frac{u_{i, j+1}^n - 2u_{i, j}^n + u_{i, j-1}^n}{(\Delta y)^2}$$
	2. 根据热方程的离散化形式，更新温度值：
	$$u_{i, j}^{n+1} = u_{i, j}^n + \alpha \Delta t \left(\frac{\Delta_{x^2}u_{i, j}}{(\Delta x)^2} + \frac{\Delta_{y^2}u_{i, j}}{(\Delta y)^2}\right) + \Delta t f_{i, j}^n$$
	其中，$u_{i, j}^n$ 是时间步 $n$ 时刻，在网格节点 $(i, j)$ 处的温度值，$u_{i, j}^{n+1}$ 是时间步 $n+1$ 时刻，在网格节点 $(i, j)$ 处的温度值。$\alpha$ 是热扩散系数，表示热传导的速率。$\Delta t$ 是时间步长，表示时间离散化的步长。$\Delta_{x^2}u_{i, j}$ 是网格节点 $(i, j)$ 处的温度在水平方向上的二阶差分近似，表示该节点的空间二阶导数。$\Delta_{y^2}u_{i, j}$ 是网格节点 $(i, j)$ 处的温度在垂直方向上的二阶差分近似，表示该节点的空间二阶导数。$(\Delta x)^2$ 和 $(\Delta y)^2$ 是空间步长的平方，用于对空间二阶导数进行归一化。$f_{i, j}^n$ 是时间步 $n$ 时刻，在网格节点 $(i, j)$ 处的外部源项。


1. 重复迭代：重复进行迭代计算，直到达到所需的时间步数 $M$ 或满足停止条件。
<div style="page-break-after: always;"></div>

# 三、求解方法
## 1. 构建差分方程
该问题的差分方程为：
$$\frac{1}{\Delta t}\left(u_{i, j}^{n+1} - u_{i, j}^n - \alpha \Delta t \left(\frac{\Delta_{x^2}u_{i, j}}{(\Delta x)^2} + \frac{\Delta_{y^2}u_{i, j}}{(\Delta y)^2}\right)\right) = f_{i, j}^n$$
在差分方程中，我们可以从初始条件开始，逐步迭代更新每个网格点的温度值。通过在每个时间步长中使用差分方程的右侧项，我们可以计算出下一个时间步长中各个网格点的温度值。通过重复这个迭代过程，我们可以模拟热传导过程的演化。随着时间的推移，温度在空间中的分布会根据差分方程的计算逐渐变化。

当差分方程的迭代达到稳定状态或满足停止条件时，我们可以得到最终的解。这个解是差分方程在离散网格上的数值近似，它代表了热传导方程在给定初始条件和边界条件下的温度分布。
## 2. 边界条件带入差分方程
该案例中使用了迪利克雷条件作为边界。迪利克雷条件指定了边界上的温度值，也就是固定温度边界条件。

在迭代过程中，差分方程会根据当前时间步骤的温度值和相邻点的温度值计算下一个时间步骤的温度值。然而，对于边界点，它们的温度值是由边界条件直接指定的，而不是通过差分方程计算得出的。

对于内部网格点$(i, j)$：
$$\frac{1}{\Delta t}\left(u_{i, j}^{n+1} - u_{i, j}^n - \alpha \Delta t \left(\frac{\Delta_{x^2}u_{i, j}}{(\Delta x)^2} + \frac{\Delta_{y^2}u_{i, j}}{(\Delta y)^2}\right)\right) = f_{i, j}^n$$
对于边界点，我们需要考虑四个边界条件：
1. 左边界：$$u_{0, j}^{n+1}=boundary_temperature_left$$
其中 $boundary_temperature_left$ 表示左边界上固定的温度值。
3. 右边界：$$u_{N_x, j}^{n+1} = boundary_temperature_right$$
其中 $boundary_temperature_right$ 表示右边界上固定的温度值，$N_x$ 是横向网格点数。  
5. 上边界：$$u_{i, N_y}^{n+1} = boundary_temperature_top$$
其中 $boundary_temperature_top$ 表示上边界上固定的温度值，$N_y$ 是纵向网格点数。 
7. 下边界：$$u_{i, 0}^{n+1} = boundary_temperature_bottom$$
其中 $boundary_temperature_bottom$ 表示下边界上固定的温度值。
<div style="page-break-after: always;"></div>
## 3. 差分方程求解
**LU求解器：**LU求解器使用LU分解的方法求解线性方程组。LU分解将系数矩阵分解为下三角矩阵（L）和上三角矩阵（U）的乘积，使得原始的线性方程组可以被表示为LUx=b的形式。
- 将差分方程中的离散项和边界条件转化为矩阵形式。
- 进行LU分解，将系数矩阵分解为下三角矩阵L和上三角矩阵U。
- 对于每个时间步n，根据当前解的值计算右侧项f的值。
- 利用前代和回代的方法，先求解Ly=f，得到中间向量y。
- 再求解Uu=y，得到当前时间步n+1的解$u^{n+1}$。
- 重复以上步骤，直到达到所需的时间步数或满足收敛条件。

**MG求解器：**MG求解器采用多重网格（Multigrid）的方法求解线性方程组。多重网格方法利用不同精度的网格进行迭代求解，通过在粗网格上求解来加速收敛速度。
- 将差分方程中的离散项和边界条件转化为矩阵形式。
- 定义多层次网格结构，从粗到细，包括粗网格和细网格。
- 在粗网格上初始化初始解，可以使用简单的迭代方法或其他方法得到初始解。
- 在每个层次上进行以下迭代过程：
    - 在粗网格上进行若干次迭代求解，得到粗网格上的近似解。
    - 利用限制（restrict）操作，将粗网格上的解限制到细网格上作为初始解。
    - 在细网格上进行若干次迭代求解，得到细网格上的更精确的解。
    - 利用插值（interpolate）操作，将细网格上的解限制到粗网格上。
- 重复以上层次迭代过程，直到达到所需的收敛精度或层次迭代次数。
- 得到最终的解。
# 四、实验过程
## 1. 实验方法
1.下载PETSc
首先，需要下载PETSc的源代码。可以在PETSc的官方网站（https://www.mcs.anl.gov/petsc/）上找到最新的版本。下载完成后，解压缩源代码，并进入解压缩后的目录。

2.运行example45
![[Pasted image 20230619002034.png]]

3.命令行参数说明
- -sol_type quadratic_linear：设置有限元空间类型为二次线性表示使用具有二次精度的形状函数来逼近解
- -dm_plex_simplex 0：设置网格拓扑结构为一般多面体(genera polytope)而非单纯形(simplex)。这是一种较为灵活的表示方式，可以处理不规则的网格
- -dm_refine 1：将初始网格细化一次，将每一个网格细分成四个网格，这将增加计算节点数并提高计算精度
- -temp_petscspace_degree 1：设置温度场的有限元多项式次数为的一次，使用具有一次精度的形状函数来逼近温度场
- -dmts_check 0.0001：设置时间步长检查的容忍度，如果时间步长变化超过此值，则会重新估计最优时间步长
- -ts_type beuler：设置时间积分器类型为向后欧拉方法(backv ward Euler method)，这是一种常用的隐式时间积分器，保证稳定性
- -ts_max_steps 5：设置时间步数的最大值为5，即模拟的时间跨度为5*Δt(Δt为时间步长)
- -ts_dt 0.1：设置时间步长为0.1
- -snes_error_if_not_converged：如果非线性求解器(SNES)没有收敛，则报告错误
- -pc_type lu：设置预处理程序类型为LU分解。这是一种经典的数值线性代数方法，用于加速矩阵求解和求逆运算
## 2. 实验结果
1.修改dm_refine,其他参数不变
- -sol_type quadratic_linear -temp_petscspace_degree 1
- -dmts_check .0001 -ts_type beuler
- -ts_max_steps 5 -ts_dt 0.1 -pc_type lu

| dm_refine | 迭代次数 | memory/bytes | L_2 Error  | L_2 Residual | 计算时间/s |
| --------- | -------- | ------------ | ---------- | ------------ | ---------- |
| 1         | 1        | 1.155e+06    | 0.0208333  | 7.8222e-16   | 0.10       |
| 2         | 1        | 1.233e+06    | 0.00520833 | 1.55914e-15  | 0.25       |
| 3         | 1        | 0.00130208   | 0.00130208 | 3.19109e-15  | 0.75       |

随着网格精细度的提高，计算时间和内存使用量也随之增加。同时，L2误差也随着网格精细度的提高而下降，这表明数值解的精度随着网格精细度的提高而提高。

2.修改dm_refine,其他参数不变，并行数量n=4,修改预处理类型
- -sol_type quadratic_linear -temp_petscspace_degree 1
- -dmts_check .0001 -ts_type beuler
- -ts_max_steps 5 -ts_dt 0.1 -pc_type mg

| dm_refine | 迭代次数 | memory/bytes | L_2 Error  | L_2 Residual | 计算时间/s |
| --------- | -------- | ------------ | ---------- | ------------ | ---------- |
| 1         | 5        | 5.673e+06    | 0.0208333  | 7.86932e-16  | 0.51       |
| 2         | 6        | 5.759e+06    | 0.00520833 | 1.55078e-15  | 0.58       |
| 3         | 9        | 6.116e+06    | 0.00130208 | 3.19228e-15  | 0.89       |

处理类型更改为多重网格(mg)，随着网格的细化，迭代次数有所增加，L2误差都在不断减小，说明数值解的精度在不断提高。

3.修改temp_petscspace_degree,其他参数不变
- -sol_type quadratic_linear -dm_refine 2
- -dmts_check .0001 -ts_type beuler
- -ts_max_steps 5 -ts_dt 0.1 -pc_type mg

| temp_petscspace_degree | 迭代次数 | memory/bytes | L_2 Error   | L_2 Residual | 计算时间/s |
| ---------------------- | -------- | ------------ | ----------- | ------------ | ---------- |
| 1                      | 5        | 5.759e+06    | 0.00520833  | 1.55078e-15  | 0.63       |
| 2                      | 11       | 6.120e+06    | 7.54414e-16 | 5.41977e-14  | 0.85       |
| 4                      | 23       | 8.430e+06    | 6.50302e-16 | 1.64925e-13  | 1.5  

petscspace_degree的增加可以提高数值解的精度，但是会增加计算时间和内存占用。因此，在实际应用中需要根据具体情况选择合适的petscspace_degree，以达到精度和效率的平衡。

<div style="page-break-after: always;"></div>


# 五、参考文献
[1] 维基百科编者. 非结构网格[G/OL]. 维基百科, 2013(20130407)[2013-04-07]. [https://zh.wikipedia.org/w/index.php?title=%E9%9D%9E%E7%BB%93%E6%9E%84%E7%BD%91%E6%A0%BC&oldid=26095132](https://zh.wikipedia.org/w/index.php?title=%E9%9D%9E%E7%BB%93%E6%9E%84%E7%BD%91%E6%A0%BC&oldid=26095132).
[2] 维基百科编者. 熱傳導方程式[G/OL]. 维基百科, 2022(20220716)[2022-07-16]. [https://zh.wikipedia.org/w/index.php?title=%E7%86%B1%E5%82%B3%E5%B0%8E%E6%96%B9%E7%A8%8B%E5%BC%8F&oldid=72711920](https://zh.wikipedia.org/w/index.php?title=%E7%86%B1%E5%82%B3%E5%B0%8E%E6%96%B9%E7%A8%8B%E5%BC%8F&oldid=72711920).
[3] 维基百科编者. 遞迴關係式[G/OL]. 维基百科, 2022(20220401)[2022-04-01]. [https://zh.wikipedia.org/w/index.php?title=%E9%81%9E%E8%BF%B4%E9%97%9C%E4%BF%82%E5%BC%8F&oldid=70934366](https://zh.wikipedia.org/w/index.php?title=%E9%81%9E%E8%BF%B4%E9%97%9C%E4%BF%82%E5%BC%8F&oldid=70934366).
[4] 维基百科编者. LU分解[G/OL]. 维基百科, 2022(20220322)[2022-03-22]. [https://zh.wikipedia.org/w/index.php?title=LU%E5%88%86%E8%A7%A3&oldid=70756137](https://zh.wikipedia.org/w/index.php?title=LU%E5%88%86%E8%A7%A3&oldid=70756137).
[5] 维基百科编者. 偏微分方程數值方法[G/OL]. 维基百科, 2023(20230405)[2023-04-05]. [https://zh.wikipedia.org/w/index.php?title=%E5%81%8F%E5%BE%AE%E5%88%86%E6%96%B9%E7%A8%8B%E6%95%B8%E5%80%BC%E6%96%B9%E6%B3%95&oldid=76673926](https://zh.wikipedia.org/w/index.php?title=%E5%81%8F%E5%BE%AE%E5%88%86%E6%96%B9%E7%A8%8B%E6%95%B8%E5%80%BC%E6%96%B9%E6%B3%95&oldid=76673926).
